<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Earn - Admin Panel</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #e0f7fa, #ffffff);
      margin: 0;
      padding: 0;
    }
    .login-box, .panel {
      max-width: 400px;
      margin: 60px auto;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      padding: 20px;
    }
    h2 { color: #00796b; text-align: center; }
    input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      background: #00796b;
      color: white;
      border: none;
      padding: 10px;
      width: 100%;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { background: #004d40; }
    .section {
      background: #e0f2f1;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
    }
    .withdraw-item {
      background: #f1f8e9;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .withdraw-item button {
      width: 48%;
      margin: 2px 1%;
      font-size: 14px;
    }
    .settings input {
      width: calc(100% - 20px);
    }
  </style>
</head>
<body>

  <div class="login-box" id="loginBox">
    <h2>Admin Login</h2>
    <input type="email" id="email" placeholder="Enter Email">
    <input type="password" id="password" placeholder="Enter Password">
    <button id="loginBtn">Login</button>
  </div>

  <div class="panel" id="adminPanel" style="display:none;">
    <h2>Smart Earn Admin</h2>

    <div class="section settings">
      <h3>‚öô Settings</h3>
      <label>Per Ad Earning (‡ß≥)</label>
      <input type="number" id="adPayout" step="0.1">
      <label>Per Refer Earning (‡ß≥)</label>
      <input type="number" id="referPayout" step="0.1">
      <label>Minimum Withdraw (‡ß≥)</label>
      <input type="number" id="minWithdraw" step="1">
      <button id="saveSettings">üíæ Save Settings</button>
    </div>

    <div class="section">
      <h3>üí∞ Withdraw Requests</h3>
      <div id="withdrawList"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getDatabase, ref, onValue, update, set } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

    // ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ Firebase ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶®
    const firebaseConfig = {
      apiKey: "AIzaSyAbbvEUnjEnbOPtZJyqL-CUEDy_nAZtGT4",
      authDomain: "hridoy-f9c90.firebaseapp.com",
      projectId: "hridoy-f9c90",
      storageBucket: "hridoy-f9c90.firebasestorage.app",
      messagingSenderId: "378490678321",
      appId: "1:378490678321:web:623f8de0c24dda4dfdb910",
      measurementId: "G-5X6Z7BWTFY"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const loginBox = document.getElementById("loginBox");
    const adminPanel = document.getElementById("adminPanel");
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const withdrawList = document.getElementById("withdrawList");

    const adminEmail = "admin@gmail.com";
    const adminPass = "42145643";

    document.getElementById("loginBtn").addEventListener("click", () => {
      const email = emailInput.value.trim();
      const pass = passwordInput.value.trim();

      if (email === adminEmail && pass === adminPass) {
        loginBox.style.display = "none";
        adminPanel.style.display = "block";
      } else {
        alert("‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°!");
      }
    });

    // Load settings
    const settingsRef = ref(db, "settings");
    onValue(settingsRef, (snap) => {
      if (snap.exists()) {
        const s = snap.val();
        document.getElementById("adPayout").value = s.adPayout || 0.5;
        document.getElementById("referPayout").value = s.referPayout || 1;
        document.getElementById("minWithdraw").value = s.minWithdraw || 10;
      }
    });

    document.getElementById("saveSettings").addEventListener("click", async () => {
      const s = {
        adPayout: parseFloat(document.getElementById("adPayout").value),
        referPayout: parseFloat(document.getElementById("referPayout").value),
        minWithdraw: parseFloat(document.getElementById("minWithdraw").value)
      };
      await set(settingsRef, s);
      alert("‚úÖ Settings updated successfully!");
    });

    // Withdraw Requests
    const withdrawRef = ref(db, "withdraws");
    onValue(withdrawRef, (snap) => {
      withdrawList.innerHTML = "";
      if (snap.exists()) {
        const data = snap.val();
        Object.entries(data).forEach(([id, item]) => {
          const div = document.createElement("div");
          div.className = "withdraw-item";
          div.innerHTML = `
            <p><b>User:</b> ${item.userId}</p>
            <p><b>Method:</b> ${item.method}</p>
            <p><b>Amount:</b> ‡ß≥${item.amount}</p>
            <p><b>Account:</b> ${item.account}</p>
            <p><b>Status:</b> ${item.status}</p>
            <button onclick="approve('${id}', ${item.amount}, '${item.userId}')">‚úÖ Approve</button>
            <button onclick="reject('${id}')">‚ùå Reject</button>
          `;
          withdrawList.appendChild(div);
        });
      } else {
        withdrawList.innerHTML = "<p>No withdraw requests yet.</p>";
      }
    });

    // Approve / Reject Functions
    window.approve = async (id, amount, userId) => {
      await update(ref(db, "withdraws/" + id), { status: "approved" });
      const userRef = ref(db, "users/" + userId);
      const snap = await (await import("https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js")).get(userRef);
      if (snap.exists()) {
        const user = snap.val();
        const newBalance = (user.balance || 0) - amount;
        await update(userRef, { balance: newBalance });
      }
      alert("‚úÖ Withdraw approved!");
    };

    window.reject = async (id) => {
      await update(ref(db, "withdraws/" + id), { status: "rejected" });
      alert("‚ùå Withdraw rejected!");
    };
  </script>
</body>
</html>

